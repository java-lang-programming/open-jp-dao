<!doctype html>
<html>
<head>
  <!-- https://v1.tailwindcss.com/components/alerts -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" type="text/css" href="../css/v1_design.css" />
</head>
<body>
  <section>
    <!-- header -->
    <!-- TODO 背景をwhite -->
    <div class="container">
      <heade>
        <!-- header 1行目 -->
        <div x-data="{ open: open }" class="bg-white mx-auto flex max-w-screen-xl p-5 md:flex-row">
          <div class="flex flex-row items-center justify-between lg:justify-start">
            <a href="#" class="text-lg font-bold text-blue-600 lg:pr-8">Wan 
              <sup>2</sup>
            </a>
          </div>
          <nav :class="{'flex': open, 'hidden': !open}" class="hidden grow flex-col pb-4 md:flex md:flex-row md:justify-end md:pb-0 lg:pl-2">
            <div class="inline-flex list-none items-center gap-2 lg:ml-auto">
              <!-- TODO ボタンの色red -->
              <button class="flex items-center rounded-xl border-gray-600 py-2.5 text-center font-medium text-white transition duration-500 ease-in-out bg-red-700 hover:bg-red-800 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-offset-2 lg:px-8">ログアウト</button>
            </div>
          </nav>
        </div>

        <!-- header 2行目 TODO お問い合わせを右に-->
        <div class="mx-auto max-w-screen-xl">
          <div class="overflow-y-auto whitespace-nowrap bg-gray-50 p-5">
            <ul class="inline-flex list-none items-center">
              <!-- <li>
            <a href="#" class="mr-1 rounded-md px-4 py-1 text-base text-gray-500 ring-offset-2 ring-offset-current transition duration-500 ease-in-out hover:text-blue-600 focus:outline-none focus:ring-2">Home</a>
          </li>-->
              <li class="font-bold underline">ドル円外貨預金元帳作成</li>
              <li>
                <a href="../dollar_yen_transactions/index.html" class="mr-1 rounded-md px-4 py-1 text-base text-gray-500 ring-offset-2 ring-offset-current transition duration-500 ease-in-out hover:text-blue-600 focus:outline-none focus:ring-2">ドル円外貨預金元帳</a>
              </li>
              <li>
                <a href="#" class="mr-1 rounded-md px-4 py-1 text-base text-gray-500 ring-offset-2 ring-offset-current transition duration-500 ease-in-out hover:text-blue-600 focus:outline-none focus:ring-2">お知らせ・ご案内</a>
              </li>
              <li>
                <a href="../settings/index.html" class="mr-1 rounded-md px-4 py-1 text-base text-gray-500 ring-offset-2 ring-offset-current transition duration-500 ease-in-out hover:text-blue-600 focus:outline-none focus:ring-2">設定</a>
              </li>
            </ul>
          </div>
        </div>
        <!-- login情報 -->
        <div class="bg-white mx-auto max-w-screen-xl py-4">
          <div class="mx-auto flex items-center justify-between px-4">
            <div class="text-left">0x91582...CC89D(hoverで長い表示)</div>
            <div class="text-center">munbai</div>
            <div class="text-right">最終ログイン:2025/01/09</div>
          </div>
        </div>
        <!-- imformation -->
        <div class="bg-white mx-auto max-w-screen-xl py-4">
          <div class="mx-auto flex px-4">
            <div class="mx-auto">確定申告は2026年2月から開始されます。早めに準備をしておきましょう。</div>
          </div>
        </div>
      </heade>

      <!-- 項目を二つ並べる　左が sbiで右がwanawn ---  -->
      <div class="p-4 md:p-8 bg-gray-50 min-h-screen">
        <div class="max-w-2xl mx-auto">
          
          <div class="relative flex items-center mb-8">
            <a href="#" class="absolute left-0 text-blue-600 hover:text-blue-800 flex items-center transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              <span class="hidden md:inline text-sm font-bold">一覧へ戻る</span>
            </a>
            <h1 class="text-2xl font-bold text-gray-800 text-center w-full">取引登録</h1>
          </div>

          <div class="bg-white shadow-md rounded-lg p-6 md:p-10 border border-gray-200">
            <form action="#" method="POST" class="space-y-6">
              
              <div>
                <label for="content" class="block text-sm font-bold text-gray-700 mb-2">
                  内容 <span class="text-red-500">*</span>
                </label>
                <input 
                  type="text" 
                  id="content" 
                  name="content" 
                  placeholder="例：オフィス備品代" 
                  class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition appearance-none"
                  required
                >
              </div>

              <div>
                <label for="type" class="block text-sm font-bold text-gray-700 mb-2">
                  取引種別 <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                  <select 
                    id="type" 
                    name="type" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition appearance-none bg-white cursor-pointer"
                    required
                  >
                    <option value="" disabled selected>選択してください</option>
                    <option value="income">収入</option>
                    <option value="expense">支出</option>
                  </select>
                  <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                      <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                    </svg>
                  </div>
                </div>
              </div>

              <hr class="my-8 border-gray-100">

              <div class="flex flex-col md:flex-row gap-3">
                <button type="button" class="order-2 md:order-1 flex-1 bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-md hover:bg-gray-100 transition">
                  キャンセル
                </button>
                <button type="submit" class="order-1 md:order-2 flex-1 bg-blue-600 text-white font-bold py-3 rounded-md hover:bg-blue-700 shadow-md transition">
                  保存する
                </button>
              </div>

            </form>
          </div>

          <div class="mt-8 text-center">
            <button type="button" class="text-red-500 hover:text-red-700 text-sm font-medium underline transition">
              この取引データを削除する
            </button>
          </div>

        </div>
      </div>

      <!-- body -->
      <footer class="bg-white rounded-lg shadow-sm dark:bg-gray-900 m-4">
        <div class="w-full max-w-screen-xl mx-auto p-4 md:py-8">
          <div class="sm:flex sm:justify-center sm:items-center">
            <!--<a href="https://flowbite.com/" class="flex items-center mb-4 sm:mb-0 space-x-3 rtl:space-x-reverse">
              <img src="https://flowbite.com/docs/images/logo.svg" class="h-8" alt="Flowbite Logo" />
              <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Flowbite</span>
          </a>-->
            <ul class="flex flex-wrap items-center mb-6 text-sm font-medium text-gray-500 sm:mb-0 dark:text-gray-400">
              <li>
                <a href="./terms.html" class="hover:underline me-4 md:me-6">利用規約</a>
              </li>
              <li>
                <a href="#" class="hover:underline me-4 md:me-6">プライバシーポリシー</a>
              </li>
              <li>
                <a href="#" class="hover:underline">Contact</a>
              </li>
            </ul>
          </div>
          <hr class="my-6 border-gray-200 sm:mx-auto dark:border-gray-700 lg:my-8" />
          <span class="block text-sm text-gray-500 sm:text-center dark:text-gray-400">© 2025 
            <a href="https://flowbite.com/" class="hover:underline">Marsa</a>. All Rights Reserved.
          </span>
        </div>
      </footer>
    </div>
  </section>
</body>
<script>
  // エラーメッセージ要素とOK表示要素を取得
  // エラーメッセージ要素とOK表示要素を取得
  const dateInput = document.getElementById('default-datepicker');
  const dateError = document.getElementById('dateError');
  const dateOk = document.getElementById('dateOk');

  const amountInput = document.getElementById('en_dollar_value_amount');
  const amountError = document.getElementById('amountError');
  const amountOk = document.getElementById('amountOk');

  const allotmentAmountInput = document.getElementById('allotment_amount');
  const allotmentAmountError = document.getElementById('allotmentAmountError');
  const allotmentAmountOk = document.getElementById('allotmentAmountOk');

  const allotmentRateInput = document.getElementById('allotment_rate');
  const allotmentRateError = document.getElementById('allotmentRateError');
  const allotmentRateOk = document.getElementById('allotmentRateOk'); // NG表示と共有

  const form = document.getElementById('transactionForm');

  // 入力フィールド、エラー表示、OK表示の参照を保持するMap
  const inputRefs = new Map();
  inputRefs.set(dateInput, { error: dateError, ok: dateOk });
  inputRefs.set(amountInput, { error: amountError, ok: amountOk });
  inputRefs.set(allotmentAmountInput, { error: allotmentAmountError, ok: allotmentAmountOk });
  inputRefs.set(allotmentRateInput, { error: allotmentRateError, ok: allotmentRateOk });

  // 日付形式の検証 (yyyy/mm/dd)
  function isValidDate(dateString) {
    if (!dateString) return false;
    const regex = /^(\d{4})\/(\d{2})\/(\d{2})$/;
    const match = dateString.match(regex);
    if (!match) return false;

    const year = parseInt(match[1], 10);
    const month = parseInt(match[2], 10);
    const day = parseInt(match[3], 10);

    const date = new Date(year, month - 1, day);
    return date.getFullYear() === year && date.getMonth() === month - 1 && date.getDate() === day;
  }

  // 日本円の金額形式の検証（カンマ区切り、数字のみ）
  function isValidJapaneseYen(amountString) {
    if (!amountString) return true; // 任意入力の場合
    const cleanAmount = amountString.replace(/,/g, '');
    return /^\d+$/.test(cleanAmount) && !isNaN(parseInt(cleanAmount, 10));
  }

  // 按分率の検証 (0超1.0まで)
  function isValidAllotmentRate(rateString) {
    if (!rateString) return true; // 任意入力の場合
    const rate = parseFloat(rateString);
    return !isNaN(rate) && rate > 0 && rate <= 1.0;
  }

  // エラー/OK表示とボーダー色の切り替えヘルパー関数
  function toggleValidationDisplay(inputElement, isValid) {
    const refs = inputRefs.get(inputElement);
    const errorElement = refs.error;
    const okElement = refs.ok;

    alert();

    // ボーダー色の切り替え
    inputElement.classList.remove('border-red-500', 'border-green-500'); // 両方除去
    if (!isValid) {
      inputElement.classList.add('border-red-500');
    } else if (inputElement.value !== '') { // 値がある場合のみ緑色にする（空の必須項目は緑にしない）
      inputElement.classList.add('border-green-500');
    }

    // エラーメッセージの表示/非表示
    if (errorElement) { // エラー要素が存在する場合のみ操作
        if (!isValid) {
            errorElement.classList.remove('hidden');
        } else {
            errorElement.classList.add('hidden');
        }
    }

    // OK表示の表示/非表示
    if (okElement) { // OK要素が存在する場合のみ操作
        // 按分率のNG表示は常にNG
        if (inputElement === allotmentRateInput && !isValid && inputElement.value !== '') {
            okElement.textContent = 'NG';
            okElement.classList.remove('hidden', 'text-green-500');
            okElement.classList.add('text-red-500');
        } else if (isValid && inputElement.value !== '') { // 有効かつ入力値がある場合
            okElement.textContent = 'OK';
            okElement.classList.remove('hidden', 'text-red-500');
            okElement.classList.add('text-green-500');
        } else { // 無効、または空の場合
            okElement.classList.add('hidden');
        }
    }
  }

  // 入力値検証と表示更新
  function validateInput(inputElement) {
    let isValid = true;

    if (inputElement === dateInput) {
      isValid = isValidDate(inputElement.value);
    } else if (inputElement === amountInput) {
      isValid = isValidJapaneseYen(inputElement.value) && inputElement.value !== ''; // 必須チェック
    } else if (inputElement === allotmentAmountInput) {
      isValid = isValidJapaneseYen(inputElement.value); // 任意入力
    } else if (inputElement === allotmentRateInput) {
      isValid = isValidAllotmentRate(inputElement.value); // 任意入力
    }

    toggleValidationDisplay(inputElement, isValid);
    return isValid;
  }

  // 各入力フィールドのblurイベント（フォーカスが外れた時）で検証を実行
  dateInput.addEventListener('blur', () => validateInput(dateInput));
  amountInput.addEventListener('blur', () => validateInput(amountInput));
  allotmentAmountInput.addEventListener('blur', () => validateInput(allotmentAmountInput));
  allotmentRateInput.addEventListener('blur', () => validateInput(allotmentRateInput));

  // フォーム送信時の検証
  form.addEventListener('submit', function(event) {
    let formIsValid = true;

    // 全ての必須項目と任意項目の検証を実行
    formIsValid = validateInput(dateInput) && formIsValid;
    formIsValid = validateInput(amountInput) && formIsValid;
    formIsValid = validateInput(allotmentAmountInput) && formIsValid;
    formIsValid = validateInput(allotmentRateInput) && formIsValid;

    if (!formIsValid) {
      event.preventDefault(); // フォームの送信を阻止
      alert('入力内容に不備があります。エラーメッセージを確認してください。');
    } else {
      alert('フォームが正常に送信されました！');
      // 実際にはここでサーバーサイドへのデータ送信処理などを記述
      // event.target.submit(); // フォームを実際に送信する場合
    }
  });

  // 日本円の金額入力時にカンマを自動挿入
  function formatYenInput(event) {
    let input = event.target.value.replace(/,/g, '');
    if (input === '') {
      event.target.value = '';
      validateInput(event.target); // 空になった場合のバリデーションを再度実行
      return;
    }
    let num = parseInt(input, 10);
    if (isNaN(num)) {
      // 数字以外が入力された場合は何もしない（不正な入力はblurでチェック）
      return;
    }
    event.target.value = num.toLocaleString();
    validateInput(event.target); // フォーマット後もバリデーションを再度実行
  }

  amountInput.addEventListener('input', formatYenInput);
  allotmentAmountInput.addEventListener('input', formatYenInput);

  // 初期ロード時にもバリデーションを実行して状態を反映（例：サーバー側からエラーが返された場合など）
  // ページロード時に既存の入力値があれば、OK/NG表示とボーダー色を反映させる
  // document.addEventListener('DOMContentLoaded', () => {
  //   alert("call")
  //     validateInput(dateInput);
  //     validateInput(amountInput);
  //     validateInput(allotmentAmountInput);
  //     validateInput(allotmentRateInput);
  // });

</script>
</html>
